<UserControl x:Class="WolvenKit.Views.Documents.CombinedSceneView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:documents="clr-namespace:WolvenKit.App.ViewModels.Documents;assembly=WolvenKit.App"
             xmlns:local="clr-namespace:WolvenKit.Views.Documents"
             xmlns:graphEditor="clr-namespace:WolvenKit.Views.GraphEditor"
             xmlns:iconPacks="http://metro.mahapps.com/winfx/xaml/iconpacks"
             xmlns:shell="clr-namespace:WolvenKit.App.ViewModels.Shell;assembly=WolvenKit.App"
             xmlns:tools="clr-namespace:WolvenKit.Views.Tools"
             xmlns:editors="clr-namespace:WolvenKit.Views.Editors"
             xmlns:syncfusion="http://schemas.syncfusion.com/wpf"
             mc:Ignorable="d" 
             d:DataContext="{d:DesignInstance documents:CombinedSceneViewModel, IsDesignTimeCreatable=False}"
             d:DesignHeight="800" d:DesignWidth="1200">
    <UserControl.Resources>
        <Style x:Key="SpacedWolvenKitTabControl" 
               BasedOn="{StaticResource WolvenKitTabControl}"
               TargetType="{x:Type syncfusion:TabControlExt}">
            <Setter Property="TabItemSelectedBackground" Value="{StaticResource WolvenKitRedShadow}" />
            <Setter Property="TabItemHoverBackground" Value="{StaticResource WolvenKitRed}" />
            <Setter Property="TabItemSelectedBorderBrush" Value="{StaticResource WolvenKitRedShadow}" />
            <Setter Property="TabItemHoverBorderBrush" Value="{StaticResource WolvenKitRed}" />
        </Style>
        
        <Style x:Key="SpacedTabItemStyle" 
               BasedOn="{StaticResource SyncfusionTabItemExtStyle}"
               TargetType="{x:Type syncfusion:TabItemExt}">
            <Setter Property="Padding" Value="12,8,12,8"/>
            <Setter Property="Margin" Value="0,0,2,0"/>
        </Style>
    </UserControl.Resources>
    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="2*" />
            <ColumnDefinition Width="Auto" />
            <ColumnDefinition Width="3*" />
        </Grid.ColumnDefinitions>

        <!-- Left Panel: Curated Tab Control -->
        <syncfusion:TabControlExt Grid.Column="0" 
                                  Style="{StaticResource SpacedWolvenKitTabControl}"
                                  ItemContainerStyle="{StaticResource SpacedTabItemStyle}"
                                  ItemsSource="{Binding Tabs}"
                                  SelectedItem="{Binding SelectedTab, Mode=TwoWay}">
            <syncfusion:TabControlExt.ItemTemplate>
                <DataTemplate DataType="{x:Type documents:SceneTabDefinition}">
                    <StackPanel Orientation="Horizontal">
                        <iconPacks:PackIconMaterial Kind="{Binding Icon}" VerticalAlignment="Center" Margin="0,0,8,0" />
                        <TextBlock Text="{Binding Header}" VerticalAlignment="Center" />
                    </StackPanel>
                </DataTemplate>
            </syncfusion:TabControlExt.ItemTemplate>
            <syncfusion:TabControlExt.ContentTemplate>
                <DataTemplate DataType="{x:Type documents:SceneTabDefinition}">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="3*" />
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="2*" />
                        </Grid.ColumnDefinitions>

                        <!-- RedTreeView bound directly to the filtered ICollectionView -->
                        <tools:RedTreeView Grid.Column="0" 
                                           ItemsSource="{Binding DataContext.SelectedTabContent, RelativeSource={RelativeSource AncestorType={x:Type local:CombinedSceneView}}}"
                                           SelectedItem="{Binding DataContext.RDTViewModel.SelectedChunk, RelativeSource={RelativeSource AncestorType={x:Type local:CombinedSceneView}}, Mode=TwoWay}"
                                           SelectedItems="{Binding DataContext.RDTViewModel.SelectedChunks, RelativeSource={RelativeSource AncestorType={x:Type local:CombinedSceneView}}, Mode=TwoWay}"/>
                        
                        <GridSplitter Grid.Column="1" Width="4" HorizontalAlignment="Stretch" Background="#FF404040"/>
                        
                        <editors:RedTypeView Grid.Column="2" DataContext="{Binding DataContext.RDTViewModel.SelectedChunk, RelativeSource={RelativeSource AncestorType={x:Type local:CombinedSceneView}}}"/>
                    </Grid>
                </DataTemplate>
            </syncfusion:TabControlExt.ContentTemplate>
        </syncfusion:TabControlExt>

        <!-- Grid Splitter -->
        <GridSplitter Grid.Column="1" Width="4" HorizontalAlignment="Stretch" Background="#FF404040"/>

        <!-- Right Panel: Graph Editor -->
        <graphEditor:GraphEditorView Grid.Column="2" Source="{Binding MainGraph}"/>
    </Grid>
</UserControl> 